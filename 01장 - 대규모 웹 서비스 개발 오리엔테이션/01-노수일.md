# 1. 대규모 웹 서비스 개발 오리엔테이션- 대규모 서비스란
- 거대한 데이터를 처리해야만 하는 웹 서비스
## 1-0. 이 책의 근간- 이 책에서 설명하는 내용들
- 대규모 웹 서비스 개발이란?
    - 대규모 데이터를 다룰 떄의 과제, 다루기 위한 기본적인 사고방식과 요령
    - 알고리즘과 데이터 구조 선택의 중요성
    - RDBMS로 모두 다룰 수 없는 규모의 데이터 처리 방법
    - 서버/인프라 시스템의 예시
## 1-1. 대규모 서비스와 소규모 서비스- 구체적으로 어느 정도가 대규모인지 하테나 서비스 예시
- 등록 사용자 100만 이상
- 1500만 UU(Unique User)/월
- 수십억 엑세스/월 (리소스 제외)
- peak시 회선 트래픽 양은 430Mbps
    - peak : 최대 트래픽, 사용량, 성능이 집중되는 순간
- 하드웨어 서버 500대 이상
### 소규모 서비스와 대규모 서비스 차이
- 대규모 서비스에만 있는 어려움
    - 확장성 확보, 부하분산 필요
    - 대량의 엑세스가 있는 서비스에서는 서버 1대로 처리할 수 없는 부하를 어떻게 처리할 것인지가 가장 큰 문제
    - scale-out
        - 서버를 횡으로 전개
        - 서버의 역할을 분담하거나 대수를 늘림
        - 시스템의 전체적인 처리 능력을 높여서 부하를 분산
    - scale-up
        - 하드웨어의 성능을 높여서 처리능력을 끌어올림
    - scale-out 시에는 비용이 절감되는 반면에 다양한 문제가 생김
        - 요청을 어떻게 분배할 것인가 -> 로드밸런서
        - DB 분산 시 데이터 동기화
        - 네트워크 통신의 지연시간
    - 다중성 확보
        - 특정 서버가 고장나거나 성능이 저하되더라도 서비스를 계속할 수 있는 구성으로 할 필요가 있음
        - scale-out 시, 서버 대수가 늘어나면 고장률도 필연적으로 늘어남
        - 웹 서비스에서는 용납될 수 없음
        - 고장, 부하에 견딜수 있는 시스템을 구성할 필요가 있음
    - 효율적 운용 필요
        - 서버 대수가 많아지면 어떤 서버가 무슨 역할을 하고 있는지 기억하는 것도 곤란해짐
        - 각 서버가 어떤 상황에 있는지 파악하는 것도 어려움
        - 감시용 소프트웨어, 정보관리를 위한 툴을 사용하여 자동화
    - 개발자 수, 개발방법의 변화
        - 대규모 서비스가 되면 여러 기술자가 역할을 분담하게 됨
        - 사람수가 늘어남에 따라 생기는 문제
        - 개발 표준화 (프로그래밍 언어, 라이브러리 프레임워크, 규약, 버전관리 시스템)
### 대규모 데이터량에 대한 대처
- 컴퓨터 데이터 처리 순서
    - 디스크에서 데이터 로드
    - 메모리에 저장
    - CPU가 데이터를 fetch해서 특정 처리 수행
    - fetch된 명령은 보다 빠른 캐시 메모리에 캐싱
- 각 단계간에 속다차가 매우 크게 나는 것이 현대 컴퓨터의 특징
- 데이터량이 많아지면 처음부터 캐시 미스가 발생
    - 저속의 디스크로의 I/O가 많이 발생
    - I/O 대기에 들어선 프로그램은 다음 처리를 수행 할 수 없음
- 대규모 서비스에서 고려되는 점
    - 데이터를 적게 가져가는법
    - 여러 서버로 분산
    - 필요한 데이터를 최소한의 횟수로 읽어들이는 법 등
## 1-2. 계속 성장하는 서비스와 대규모화의 벽
### 웹 서비스의 어려움
- 서비스가 계속 성장
- 성장함에 따라 규모를 확대
- 시스템 구성의 변화가 필요
- 보유 데이터의 증가
### 하테나 예시
#### 초기
- 초기에는 서버 1대
- 서비스가 히트되지 않았으므로 별 문제 없었음
- 사용자가 늘어남에 따라 서버에 부하
- 서비스가 정지되는 사태 발현
#### 시행착오를 거듭한 시스템 규모 확장
- 라우터 : Linux 박스
- HTTP 요청 분산 : Apache mod_rewrite
- DB 분산 : Mysql Replication
- 트래픽 증가에 비해 시스템 확장이 따라가지 못하게됨
- 수동 재가동

#### 데이터 센터로의 이전, 이전 시스템 쇄신
- 조직상으로도 미숙, 계획적인 대응 불가가 실패의 원인
    - 전담팀 구성
- 데이터 센터로 서버 이관
- 기존 시스템의 부하상황 정리
    - 병목 지점 측정, 판정
    - 서버 용도에 맞게 최적의 구성을 갖는 하드웨어 준비
        - I/O 부하가 높은 서버는 메모리 중요시
        - CPU 부하가 높은 서버는 CPU 중요시
    - 다중화
        - 로드밸런서 + 가동감시 기능이 있는 LVS+ keepalived
            - 리눅스 기반 시스템에서 로드 밸런싱과 고가용성을 제공하는 데몬 프로그램
    - 웹 기반 서버 정보관리 시스템 도입
    - 애플리케이션 로직, DB 스키마 재검토
### 시스템의 성장전략
- 소규모 서비스에서는 너무 이른 최적하는 좋은 방법이라고 할 수 없음
    - 비용이 많이 들음
- 대규모의 벽은 갑자기 눈앞에 나타남
- 어느정도의 수용능력 관리나 서비스 설계 시, 필요 이상으로 데이터를 증가시키지 않는 설계는 포함하는게 좋을 것
## 1-3. 서비스 개발의 현장
### 하테나 기술팀 체제
- 서버/인프라 시스템
    - 1,000대 규모의 호스트를 보유
    - 전담팀이 운용
    - 며칠에 한 번은 문제 발생
    - 고장, 과부하, 설정미비, 노후화 등 다양한 문제 발생
    - 부하 상황 감시
    - 인프라 개선으로 대처할 수 있는 문제는 즉시 대응
- 서비스 개발부
    - 서비스 개발, 신기능을 추가하는 역할
    - 서비스 성능 트래킹
    - 응답시간 정량화하고 한계값을 밑돌지 않도록 목표 설정해서 개선
### 하테나 커뮤니케이션 방법
- 하테나 그룹
    - 그룹웨어, 작업 의뢰, 유지보수
- IRC
    - 유지보수 진행상황, 긴급 문제, 간략한 용건
    - 시스템 로그
    - 실시간 정보 공유
- 서버 관리 툴
    - 서버 상황을 한눈에 알 수 있는 툴
### 실제 서비스 개발
- 구현자의 실력이나 난이도에 따라 페어 프로그래밍
- 전체적으로 애자일 스타일이라고 할 수 있지만, 다양한 시행착오를 겪고나니 그런 모습
### 개발에 사용하는 툴
#### 프로그래밍 언어
- Perl
    - 창업 때 부터 서버사이드
- C/C++
    - 검색 엔진 등 메모리 요건이 엄격하거나, 속도가 요구될 때
- Javascript
    - 사용자 인터페이스
- 동일 레이어인 언어는 하나로 한정한다는 정책
#### 주요 미들웨어
- Linux
- Mysql
- Apache
- memcached
#### 웹 애플리케이션 프레임워크
- 자체 개발한 Ridge라는 Perl 프레임워크
- O/R 매퍼에도 자체 개발 프레임워크
#### 주위 머신의 OS 및 에디터
- Emacs, Vim
#### 버전관리는 git, BTS는 독자 개발한 '아시카'
- 버전 관리는 이전에 CVS나 SVC를 사용했으나 git으로 이전
- BTS는 git과 연동된 독자 개발된 앱 애플리케이션

