# 01장 - 대규모 웹 서비스 개발 오리엔테이션

## 강의0 - 전체 그림 파악하기(이 책의 근간)
### 대규모 웹 서비스로의 초대
- MAU 1500만 하테나의 사례로 웹 서비스를 운영하는데 필요한 기초지식과 노하우를 공유하는 책.
- **대규모**의 전체 그림을 떠올릴 수 있도록 하는 것을 목표로 함
- 이 책은 하테나 인턴들의 강의 내용을 기반으로 쓰임

### 이 책에서 설명하는 것
- 대규모 웹 서비스 개발이란?
- 대규모 데이터를 다룰 때의 과제, 다루기 위한 기본적인 사고방식과 요령. \
  ex) OS 캐시 기능, 대규모 데이터를 전제로 한 DB 운용 방법
- 알고리즘과 데이터 구조 선택의 중요성. (대규모 데이터로 생각)
- RDB로 모두 다룰 수 없는 규모의 데이터 처리 방법. (ex. 전문 검색 엔진 만드는 법)
- 대규모 서비스가 될 것을 전제로 한 서버/인프라 시스템의 예와 개념
- 이 책은 주로 `2 ~ 5장`, `6 ~ 10장`, `11 ~ 15장`으로 세 파트로 구성된다. (`3p` 참고)
	- `2 ~ 5장` : 데이터가 많을 때 어떻게 처리해야 하는지
	- `6 ~ 10장` : 구현 단계와 관련된 파트
	- `11 ~ 15장` : 하테나의 인프라에 대해

### 이 책에서 설명하지 않는 것
- 웹 애플리케이션 개발과 관련된 기본적인 How-To, MVC 프레임워크나 O/R 매퍼 사용법 등을 다루지 않음
- 각종 소프트웨어 사용법, 아파치, MySQL의 설정방법이나 명령 등
- Perl이나 C++의 구문이나 기법 등 프로그래밍 언어에 대한 설명, 노하우
- 기본적인 알고리즘이나 데이터 구조(ex. `정렬`, `탐색`, `리스트` 등)에 대한 설명

- - -

## 강의1 - 대규모 서비스와 소규모 서비스
### 하테나의 서비스 규모
- 대규모의 수치
	- 등록 사용자는 100만명 이상, 1500만 UU(Unique User, 고유 사용자)/월
	- 수십 억 액세스/월(이미지 등으로의 액세스 제외)
	- 피크(peak) 시 회선 트래픽 양은 430Mbps
	- 하드웨어(서버)는 500대 이상
	- 일일 액세스 로그 기가바이트, DB 서버가 저장하는 데이터 규모도 기가바이트(가끔, 테라바이트)

### 소규모 서비스와 대규모 서비스의 차이
- **대규모 서비스**에만 있는 문제나 어려움은 다음과 같다.

#### 확장성 확보, 부하분산 필요
- 서버 1대로 처리할 수 없는 부하를 어떻게 처리할 것인지
- 이 책이 쓰여질 당시 10년 동안의 트랜드로는 **스케일 아웃**이 이 문제를 해결하는데 기초 전략이 된다.
	- ~~지금도 스케일 아웃이 기본인 듯?~~
	- `스케일 아웃` : 서버의 역할을 분담하거나 대수를 늘려 시스템의 처리 능력을 높여 부하를 분산하는 방법
	- `스케일 업` : 하드웨어의 성능을 높여 처리 능력을 높이는 방법

<br>

> **스케일 아웃을 사용했을 때 문제**
>
> - 사용자로부터 요청을 어떻게 분배할 것인가? (**로드 밸런서**?)
> - 데이터 동기화는 어떻게 할 것인가? (DB **클러스터링**?)
> - 네트워크 통신의 지연시간을 어떻게 할 수 있는가? (gRPC? 같은 지연 시간을 줄이기 위해)

#### 다중성 확보 (10p)
- 특정 서버가 고장 나거나 성능이 저하되더라도 서비스를 계속할 수 있는 구성이 필요
- 2001년 9월 미국의 테러가 발생했을 때 `야후`의 서버가 다운되는 일이 발생했다. \
  이때 `야후`는 `Akamai(CDN 회사)`에 컨텐츠를 캐싱해 트래픽을 우회시켜 장애를 복구했다.
- 즉, 웹 서비스는 언제 어떠한 경우라도 고장에 대해 견고해야 한다.
- Q. 다중성 확보를 어떻게 달성할 수 있을까? (클라우드 사용?)

#### 효율적 운용 필요
- 서버가 `10대`, `100대`와 같이 많아질 경우 어떤 서버가 무슨 역할을 하는지, 서버가 괜찮은지 등 관리하기 어렵다.
- 이를 위해 **감시용 소프트웨어**를 사용하고 **정보관리를 위한 툴**을 사용하는 등 자동화를 해야 한다.
	- ex) `Datadog`?, `ELK Stack`?, `Grafana(with. Prometheus)`?

#### 개발자 수, 개발방법의 변화
- 사람이 늘어남에 따라 고려해야 될 과제가 늘어난다.
	- ex. `프로그래밍 언어 통일`, `개발 표준화`, `코딩 컨벤션`, `소스코드 버전 관리`, 등

### 대규모 데이터량에 대한 대처
- 이 책에서 가장 큰 테마가 **데이터 량**에 대해서이다.
- 컴퓨터는 `디스크(HDD)에서 데이터를 로드`해 **메모리에 저장**하고, \
  `메모리에 저장된 데이터`를 **CPU가 패치**해서 특정 처리를 수행한다.
	- 이때 `메모리에서 패치된 명령`은 보다 빠른 **캐시(cache) 메모리에 캐싱**한다.
	- 이렇게 데이터는 `디스크` -> `메모리` -> `캐시 메모리` -> `CPU`와 같이 몇 단계를 경유해 처리된다.
	- 각 단계에는 속도 차이가 매우크고, `디스크가 제일 느리다.`
	- 이 속도차를 위해 OS는 다양한 방법을 사용하고, 일반적으로 `캐싱`을 많이 사용한다.
- 하지만 캐싱을 아무리 해도 **데이터량이 많아지면 결국 캐시 미스**의 확률이 높아진다.   
  즉, `어떻게 하면 데이터를 적게 가져갈 수 있을까`, `어떻게 여러 서버로 분산시킬 수 있을까`,
  `필요한 데이터를 최소한의 횟수로 읽어들일 수 있을까`, 등 이것이 **본질적인 과제**이다.

- - -
## 강의2 - 계속 성장하는 서비스와 대규모화의 벽
### 웹 서비스의 어려움 (14p)
- 일반적으로 웹 서비스는 서비스가 성장함에 따라 규모가 확대된다. 즉, 성장할 수록 시스템 구성을 변화시켜야 한다.
	- Q. 안 그런 서비스도 있나?
- 운영하면 할 수록 데이터가 쌓이게 된다. (ex. 블로그 서비스라고 하면 시간이 지날수록 `이미지`, `작성글` 등 계속 추가됨)

### 하테나가 성장하기까지
- 하테나의 시작은 `3명`에서 시작했고, 당시 서버 스펙은 `펜티엄3 PC 1대`이다.
- 이후 `하테나 안테나`, `하테나 다이어리` 등 새로운 서비스를 릴리즈한 무렵부터 사용자가 늘어갔다.
- 이렇게 사용자가 늘어갈 때 서버 1대로는 처리할 수 없어 서비스가 정지하는 일이 빈번하게 발생했다.
	- 이때 다중화와 부하분산을 적용해나기 시작. (당시 상용 로드밸런서는 너무 비싸 고려하지 않음)

#### 시행착오를 거듭한 시스템 규모확장
- 웹 서비스의 부하분산을 위해 (로드 밸런서의 상용 서비스가 비싸 직접 구축) \
  `라우터`는 저가 **Linux 박스**, \
  `HTTP 요청 분산`은 **아파치의 mod_rewrite** \
  `DB 분산`은 **MySQL의 레플리케이션** 사용
- 2004 ~ 2005년 쯤에는 트래픽 증가로 인해 시스템 확장이 따라가지 못 했다.
	- 심야가 되면 사이트가 무거워져 액세스가 불가능해 안정성에 대한 안 좋은 평이 많아졌다.
	- 또한 운영 환경도 좋지 못해 서비스가 정지되면 엔지니어가 직접 서버를 재기동해야 됐다.

#### 데이터 센터로의 이전, 시스템 쇄신 (17p)
- 1년에 걸쳐 작은 서버 룸에서 인터넷 데이터 센터로 서버를 이전하는 작업 수행
	- 이를 통해 네트워크 설계 수정과 낡은 서버를 교체했음
- 기존 시스템의 부하상황을 정리하고, 이 정보를 활용해 각 서비스 구성 중 병목지점을 측정해 \
  `I/O 부하`가 높은 서버는 **메모리**를 `CPU 부하`가 높은 서버는 **CPU**를 중요하시 하는 형태로 구성
	- Q. 이 부분이 MSA의 장점 중 하나일 것 같다. (개인적으로 MSA를 좋아하진 않지만..)
- `다중화`로는 `로드밸런서`를 이용한 Linux 박스 다중화 `가동감시`를 위해선 `LVS + keepalived` 도입

### 시스템의 성장전략 (미니멈 스타트, 변화를 내다본 관리와 설계)
- 너무 이른 최적화는 좋은 방침일 수 없음 (웹 서비스가 히트할 가능성은 매우 낮음)
- 그렇다고 아무 생각 없이 불완전하게 시작하는 서비스는 좋지 않다.
	- 어느 정도의 수용능력 관리나 서비스 설계 시에 필요 이상으로 데이터를 증가시키지 않도록 해야 한다.
- **이 책을 통해** 필요 이상으로의 비용을 들이지 않고 **미니멈 스타트(minimum start) 노하우**를 배우자.

- - -
## 강의3 - 서비스 개발의 현장
### 하테나의 기술팀 체제
크게 두 분류로 구분된 엔지니어링 팀
1. `서비스 개발부` : 하테나의 각종 서비스 구현 담당. 매일 애플리케이션 측면의 개선 담당
2. `인프라부` : 서버/인프라 시스템의 운용을 담당. 서버 준비, 데이터 센터 운용, 부하 분산 등 담당
	- 하테나는 전담 팀이 서버/인프라를 합쳐 1,000대 호스트 운영.
	- 며칠에 한 번씩 고장, 과부하, 설정미미 노후화 교체 등 문제 발생

### 하테나에서의 커뮤니케이션 방법
- 하테나가 **40명 정도** 일때 `기본적인 업무 지시는 구두`로 했다.
- 이후 담당 그룹들의 간단한 동작방식과 서버에 대해 들음

### 실제 서비스 개발
- 하테나의 개발 방식에 대해 소개함 (애자일, 코드 리뷰, 테스트 등)

### 개발에 사용하는 툴
#### 프로그래밍 언어 - Perl, C/C++, JavaScript 등
- 창업 때부터 Perl사용, 검색 엔진 등 메모리 요건이 엄격하거나 속도가 빨라야 되면 C/C++등을 사용
- UI에 관련된 부부는 JavaScript 사용\
- 언어 선택에 관한 정책은 `동일 레이어인 언어는 하나로 한정한다.` 정도가 있다.
	- ex) 웹 애플리케이션 개발에는 PHP, Python, Ruby 등의 스크립트 언어 사용 등

#### 주요 미들웨어 (미들에워/프레임워크 통일)
- Linux, Apache, MySQL, memcached 같은 웹 개발 기본에 해당하는 것들을 뜻한다.
- 안정화된 버전인지만 검사

#### 웹 애플리케이션 프레임워크 (자체 개발한 Ridge)
- 하테나는 직접 개발한 `Ridge`라는 Perl 프레임워크를 사용

#### 주의 머신의 OS 및 에디터
- 프레임워크와 미들에워는 프로덕션에서 사용하는 것과 동일한 것 사용
	- 그 외 부분은 자유(에디터, PC, OS 등)

#### 버전관리는 git, BTS는 독자 개발한 '아사카'
- 형상 관리에 있어서는 git 사용,
- **BTS(Bug Tracking System, 버그추적 시스템)**은 아사카라는 자체 개발한 웹 애플리케이션을 git과 연동 후 사용

#### 개발툴에 관해서
- 고기능의 툴보다 얼마나 효율성을 추구하는지에 따라 툴을 선택

- - -
## 1장 정리
- 대규모를 이미지하기 위해 하테나의 실제 모습 사용

