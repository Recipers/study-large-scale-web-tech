# 11. 대규모 데이터 처리를 지탱하는 서버/인프라 입문
- 웹 서비스의 백엔드
### 하테나의 인프라스트럭처
- 기술적 설명 보다는 저수준(low layer)의 설명
- 엔터프라이즈와 웹 서비스 비교
- 클라우드와 자체구축 인프라 비교
## 11-29. 엔터프라이즈 vs 웹 서비스
### 엔터프라이즈 vs 웹 서비스
- 응용범위로 보는 차이
- 정보시스템
    - 엔터프라이즈
        - 영역이 압도적으로 큼
    - 웹 서비스
        - 책이 써질 당시 10년동안 붐이 일어남
        - 전체적으로는 아직 적은 영역
   - 엔터프라이즈는 시스템이 다운되면 치명적
   - 돈이나 생명 같은 영역이 많은 것이 엔터프라이즈의 특징
   - 시스템화 대상 영역 차이에 따라 내부에 요구되는 조건도 달라지고, 이에 따라 세부 기술에 반영이 됨
#### 웹 서비스의 특징
- 엔터프라이즈와 비교
1. 트래픽의 경우
- 엔터프라이즈
    - 거대한 규모가 되는 경우는 드물음
    - 웹 서비스 : 글로벌하게 전개되고 있는 서비스에서는 어마어마한 트래픽이 발생할 가능성이 있음
2. 성장성, 성작속도
- 엔터프라이즈
    - 실제 비즈니스와 연계되어있으므로, 급격하게 성장하는 것은 아님
- 웹 서비스
    - 폭발적으로 성장할 가능성이 있음
3. 신뢰성
- 엔터프라이즈
    - 높은 신뢰성이 요구됨
    - 손해배상, 사람의 목숨
- 웹 서비스
    - 신뢰성에서 그렇게 높은 레벨이 요구되지는 않음
4. 트랜잭션 : DB에 관한 이야기
- 엔터프라이즈
    - 데이터 간 정합성을 정확히 유지해야만 함
    - 트랜잭션 처리를 이용해서 정합성을 명확히 담보하면서 처리
- 웹 서비스
    - 정합성이 일치하지 않는 경우도 허용하도록 처리하는 경우도 있음
    - 비용을 줄이거나, 적은 서버대수로 트래픽이 많이 발생하도록 하는 설계를 함
### 웹 서비스의 인프라
- 중요시되는 세 가지 포인트
1. 저비용 고효율
    - 저비용을 위한 상반관계가 있음
    - 100%의 신뢰성은 목표로 하지 않도록 함
    - 이 부분을 과감히 접고 비용을 낮춰서 효율을 높이는 방향
2. 확장성이나 응답성 등에 대한 설계를 중요시 함
    - 서비스의 성장속도를 모르거나, 사용자 경험(UX)를 위해 서비스의 응답성이 중요한 경우도 있음
    - 100%의 신뢰성을 추구하기보다 장래를 위해 제대로 확장할 것
3. 웹 서비스는 서비스 사양이 이리저리 바뀌는 경우가 있음
    - 유연하게 대응할 수 있는 인프라여야만 함
    - 엔터프라이즈 시스템은 특정 서비스 사양을 추가하고자 할 때, 반년 혹은 1년전부터 기획하고 꾸준히 준비
    - 변화가 빠른 웹 서비스 영역에서는 시기를 놓칠 수 있음
    - 개발속도를 중시한 인프라로 구성해가는 것도 매우 중요한 점
    - 배포를 가능한 간편하게
    - 배포할 때 처리 중인 요청에 영향이 없도록
    - 필요한 서버를 즉시 추가할 수 있도록
    - 배포한 코드에 문제가 발견됐을 때 곧바로 이전 상태로 돌아갈 수 있도록 대처
## 11-30. 클라우드 vs 자체구축 인프라
### 클라우드 컴퓨팅
- 웹 서비스는 저비용 고효율이 중시됨
- 클라우딩 컴퓨팅, 클라우드도 주목해야할 키워드
- Amazon EC2
- 하테나는 자체구축 인프라로 거의 전부를 구축
- 어느 쪽을 선택할지는 판단에 어려운 점이 있음
### 클라우드의 장단점
- 저가로 사용하면서 확장해갈 수 있다는 특징이 있음
- 확장성이 최대 장점
- 각각의 클라우드 서비스마다 독자적인 사양에 대응할 필요가 있음
- 본인의 실수가 아닌데도 때때로 정지하는 경우도 있음
### 하테나에서의 클라우드 서비스 사용
- 하테나에서도 Amazno Web services를 일부 사용
- 미디어 파일 전송을 위해 CDN (Amazon Cloudfront) 서비스 이용
- 미디어 저장소로서 클라우드 서비스를 이용하는 경우는 많을 것
- 클라우드 컴퓨팅이 발전속도가 빠를 것으로 보임
- 소규모 서비스를 하거나, 트라이얼 용도로는 클라우트 컴퓨팅이 아주 좋은 분야일 것
### 자체구축 인프라의 장점
1. 하드웨어 구성을 유연하게 할 수 있다
- 클라우드 컴퓨팅은 상한선이 있어서, 이 부분을 자유롭게 제어할 수 없음
- 자체 구축은 선진적인 하드웨어를 투입해서 서버 한계점을 점점 높일 수 있음
- 클라우드 컴퓨팅은 제약사항이 있는 상태에서 운영을 하게되므로 유연성을 잃을 수 있음
2. 서비스로부터의 요청에 유연하게 대응할 수 있다
- 네트워크 측면이나, 대량의 데이터를 쌓는 등의 요청에 대한 대응이 있을 수 있음
- 클라우드 컴퓨팅에서도 대응할 수는 있지만, 자체구축의 장점이라 봐도 지장이 없을 듯 함
3. 병목현상을 제어할 수 있다
- 로드밸런서나 네트워크 등에 발생하는 문제로, 시스템 규모가 커지면 무시할 수 없는 영역이 됨
- 어디에서 병목이나 지연이 발생하는지 클라우드 환경을 제공하는 측의 기술에 의존할 수 밖에 없게 됨
- 최악의 경우에도 이 문제가 얼마나 심각하고 대처하는 데 어느정도의 시간과 비용이 필요한 지 조사할 수 있음
### 자체구축 인프라와 수직통합 모델
- 수직통합 모델, 수평분산 모델이라는 개념이 있음
- 수직통합 : 물리적 계층부터 서비스 설계까지 모든 것을 한 회사에서 구축하는 모델
- 수평분산 : 각 계층마다 다른기업이 시스템을 제공, 각각이 모여 전체 시스템이 구축되는 모델
### 하테나의 서비스 규모
- 등록 사용자 수 : 150만명, 1,900만 UU/월
- 수십억 엑세스/월(이미지 엑세스 제외)
- 피크 시 회선 트래픽 양 850Mbps
- 하드웨어 600대 이상, 가상화 1,300대 정도 규모
### 하테나 북마크의 시스템 구성도
- 리버스 프록시 3대
- AP 서버 11대
- DB 서버 24대
- 캐서서버 7대
- 로드밸런서 2대
- 그 밖의 엔진 9대
- 합계 56대
- 각각의 서버는 가상화 되어 실제로는 좀더 적은 수로 되어있음
