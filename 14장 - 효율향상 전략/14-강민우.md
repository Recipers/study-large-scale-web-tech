# 14장 - 효율향상 전략
### 가상화 기술, 자체제작 서버 - 규모의 크기와 리소스 사용률
> **효율향상전략**
> - 하드웨어 효율 -> 다중화를 추진하면 이용효율은 저하
> - 가상화 기술 -> 강의 36
> 	- 호스트의 집적도 상승
> - 자체제작 서버 -> 강의 37
> 	- 필요충분한 사양을 통해 저비용화

- - -
## 강의 36: 가상화 기술
가상화 기술의 목적을 정리하면 다음과 같음
- 확장성
	- 오버헤드의 최소화
- 비용대비 성능
	- 리소스 사용률 향상, 우용의 유연함(환경의 단순화)
- 고가용성
	- 환경의 격리
- 이때 당시의 가상화 기술로는 다음과 같음
	- VMware
	- Virtual PC
	- Parallels
	- Xen -> 하테나는 이걸 사용
		- 로컬 디스크에 LVM(Logical Volumne Manager)의 파티션을 만들어 사용

### 가상화 기술의 효용
1. IPMI(Intelligent Platform Management Interface)를 대체하는 **하이퍼바이저**
	- `하이퍼바이저`: 호스트 OS를 뜻함. 서버 상에 최초 기동하는 OS (Xen 용어로는 Dom0)
	- `게스트 OS` : 호스트 OS 상에서 기동하는 OS (Xen 용어로는 DomU)
	- IPMI는 벤더에서 만든 서버 제품으로 구현되어 있는 경우가 많은 리모트 관리환경
		- ex) 전원 ON, OFF를 **원격에서 수행 가능**
	- 하테나는 IPMI의 대체품으로 하이퍼바이저라는 계층을 하나 늘려 게스트 OS를 리모트에서 제어하고 있음
	  (IPMI가 탑재되어 있지 않은 저가의 하드웨어 사용 가능)
2. 하드웨어 간 차이 흡수 -> 환경 추상화
	- 새로운 하드웨어나 오래된 하드웨어로도 차분에 신경 쓰지 말고 사용 가능
3. 준 가상화(ParaVirtualization) 사용 - Xen에 특화된 이야기
	- 하테나는 가상화로 인한 오버헤드를 줄이기 위해 하드웨어를 완전히 애뮬레이팅하지 않은 준 가상화 방식으로 사용 중
4. 리소스 소비 제어
	- 과부하 경고
	- 부하 조정
	- 재시작할 때 프로세스를 재시작 하는 것 뿐 아니라 게스트 OS의 자동 재시작도 수행
	- 게스트 OS의 자동 재시작을 위해 `monit`이라는 리소스 관리용 툴 사용

### 가상화 서버 구축정책
- **가상화 기술**을 도입하는 가장 기본적인 목적은 **하드웨어의 이용효율 향상**
	- 이용효율 향상을 위해 게스트 OS로 남아있는 리소스를 사용
	- ex) CPU 리소스가 남으면 웹 서버, I/O 리소스가 남으면 DB 서버, 메모리 용량이 남으면 캐시 서버 투입
- 리소스 소비경향이 비슷하고 부하가 높은 용도의 게스트 OS끼리는 리소스를 서로 점유하려고 하므로 같이 사용하지 않음
- 중앙에 신뢰성 높은 큰 규모의 스토리지를 두고 네트워크로 파일시스템을 마운트하는 구성을 채탁하는 방법은 사용하지 않음
	- 고가의 스토리지 서버를 사용하지 않으면 안정성을 확보할 수 없기 때문

> **요약**
> - 하드웨어 리소스 이용률 향상 (게스트 OS로 남아있는 리스스에 따라 효율성을 올릴 수 있음)
> - 같이 두는 것을 피하는 형태의 조합
> - 중앙 스토리지는 사용하지 않음

#### 가상화 서버 - 웹 서버
<img src="../image/Pasted image 20250422163421.png" width="800" height="300">
- 서버 메모리를 증가시켜 메모리의 여유가 생기면 메모리의 일부를 memcached 같은 게스트 OS를 추가해 사용

#### 가상화 서버 - DB 서버
<img src="../image/Pasted image 20250422163440.png" width="800" height="300">
- DB 서버는 메모리는 어느 정도 사용하지만 CPU 리소스와 I/O 리소스는 그다지 소비하지 않음
- 위와 같은 경우에서 웹 서버용 게스트 OS를 탑재하면 I/O와 CPU를 모두 사용할 수 있음

### 가상화로 얻은 장점 정리
> **요약**
> - 물리적인 리소스 제약에서 해방
> 	- 리소스를 동적으로 변경
> 	- VM의 마이그레이션, 복제
> -> 용이한 서버 증설 -> 더 나은 확장성 확보
> - 소프트웨어 레벨의 강력한 호스트 제어
> 	- 비정상 동작 시 문제 국소화
> 	- 호스트 제어 용이
> -> 하드웨어, 운영 비용 저하
> -> 비용 대비 성능 향상, 고가용성으로 발전

### 가상화와 운용 - 서버관리툴로 운용측면에서 가상화의 장점을 살리다
- 모니터링 툴을 만들어 사용

### 가상화 도입 시 주의할 점
- 성능상의 오버헤드가 있음, 하테나는 다음과 같은 수치를 오버헤드의 기준으로 삼음
	- CPU에서 2~3%
	- 메모리 성능에서 1할 정도
	- 네트워크 성능은 절반 정도
	- I/O 성능이 5% 정도 떨어짐
- 가상화 기술 구현상 결함으로 인해 갑자기 네트워크가 단절되는 등의 불안정 요인 증가 -> 장점이 훨씬 더 커서 사용 중

- - -
## 강의37: 하드웨어와 효율향상 - 저비용을 실현하는 요소기술
### 프로세서의 성능향상
- `무어의 법칙`으로 집적회로 상의 트랜지스터 수는 18개발마다 2배로 증가한다는 법칙

### 메모리, HDD의 비용저하
- 책 기준 3년전: 2GB 3만 엔, 8GB 12만 엔
- 책 기준 현재: 2GB * 2 5천엔, 8GB 1만 엔
- 4 core CPU 8GB인 서버 비용: `3년전: 수십만 엔`, `현재: 8만엔` -> 날짜는 모두 책이 쓰여진 기준 (2009 ~ 2010년도)

### 저가 하드웨어의 유용한 이용법 - 가상화를 전제로 한 하드웨어 사용
- 최소한의 관리 기능
- 다 core CPU
- 대량의 메모리
- flexible한 I/O 성능
	- Diskless
	- 하드웨어 RAID-10
	- SSD RAID-0
- 관리용 하드콘솔 불필요
	- IPMI 기능 -> Intel AMT

### SSD
- 양호한 랜덤엑세스 성능
- 메모리 > SSD ? ADD RAID-0/10 > HDD RAID-1
	- 메모리 정도는 아니지만 충분히 빠름
- Intel SSD X-25E/M, 하테나의 운용환경에서 가동 중 - 하테나의 경우 다수의 DB 스레이브 서버를 SSD로 사용

### Column - SSD의 수명
- SSD의 소모빈도 지표가 되는 `S.M.A.R.T` 값을 확인해보면 도움이 됨
	- 이 값은 SSD의 기록 미디어인 플래시 메모리의 소모빈도는 나타냄
	- 평균 삭제횟수가 늘어남에 따라 정규호된 값이 100에서 1로 감소해감
	- 이 값은 `smartctl` 명령으로 얻을 수 있음

